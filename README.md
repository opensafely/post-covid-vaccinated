# Impact of vaccination on the association of COVID-19 with arterial and venous thrombotic diseases: an OpenSAFELY cohort study using linked electronic health records

Abstract: The incidence of cardiovascular diseases increases after COVID-19 diagnosis. How COVID-19 vaccination and different SARS-CoV-2 variants impact on this increase is unclear. The objective was to quantify associations between COVID-19 diagnosis and cardiovascular diseases in different vaccination and variant eras in England.

You can run this project via [Gitpod](https://gitpod.io) in a web browser by clicking on this badge: [![Gitpod ready-to-code](https://img.shields.io/badge/Gitpod-ready--to--code-908a85?logo=gitpod)](https://gitpod.io/#https://github.com/opensafely/post-covid-vaccinated)

* The preprint can be found
* Analysis scripts are in the [`analysis`](./analysis) directory
* If you are interested in how we defined our code lists, look in the [codelists](https://github.com/opensafely/post-covid-vaccinated/tree/main/codelists) directory

### project.yaml
The [`project.yaml`](./project.yaml) defines project actions, run-order and dependencies for all analysis scripts. **This file should *not* be edited directly**. To make changes to the yaml, edit and run the [`create_project.R`](./analysis/create_project.R) script instead. Project actions are then run securely using [OpenSAFELY Jobs](https://jobs.opensafely.org/).

Below is a description of each action in the [`project.yaml`](./project.yaml). Arguments are denoted by {arg} in the action name.

* `vax_eligibility_inputs`
  * Runs [`vax_eligibility_inputs.R`](./analysis/vax_eligibility_inputs.R) which creates metadata for aspects of the study design which are required for the `generate_study_population` actions.
  * Creates dataframes that contain dates for each phase of vaccination and conditions for defining JCVI vacciantion groups
  
* `generate_study_population_{cohort}`
  * There are three `generate_study_population` scripts that are run to create the two study populations: vaccinated and unvaccinated. These are [`study_definition_vaccinated.py`](./analysis/study_definition_vaccinated.py), [`study_definition_electively_unvaccinated.py`](./analysis/study_definition_electively_unvaccinated.py) and [`study_definition_index.py`](./analysis/study_definition_index.py).
  * These scripts are used to define JCVI groups, vaccine variables, variables used to apply eligibility criteria, outcome variables and covariate variables. Common variables used in all three scripts can be found in [`common_variables.py`](./analysis/common_variables.py).
  
* `preprocess_data_{cohort}`
  * Runs [`preprocess_data.R`](./analysis/preprocess/preprocess_data.R) to apply dataframe tidying to `input_{cohort}.feather` (generated by `generate_study_population_{cohort}`)
  * Tidies vaccine variables, determines patient study index date, creates addtional variables (e.g. covid phenotype), tidies dataset and ensures all variables are in the correct format e.g. numeric, character etc.
  
* `stage1_data_cleaning_both`
  * Runs [`Stage1_data_cleaning.R`](./analysis/preprocess/Stage1_data_cleaning.R)
  * Applies quality assurance rule and inclusion/exclusion criteria
  * Outputted dataset is analysis ready
  
* `stage1_end_date_table_{cohort}`
  * Runs [`create_follow_up_end_date.R`](./analysis/preprocess/create_follow_up_end_date.R) which creates a dataframe of patient study end dates for each outcome of interest.
  
* `stage2_missing_table1_both`
  * Runs [`Stage2_missing_table1.R`](./analysis/descriptives/Stage2_missing_table1.R)
  *Check for missing data within variables 
  * Creates the summary statistics for Table 1 of the manuscript which can then be outputted
  
* `stage4_table_2_{cohort}`
  * Runs [`table_2.R`](./analysis/descriptives/table_2.R) which calculates pre- and post-exposure event counts and person days of follow-up for all outcomes and subgroups.
  * Used for Table 2 in the manuscript
  
* `stage4_venn_diagram_both`

* `Analysis_cox_{outcome}_{cohort}`

* `stata_cox_model_{outcome}_{subgroup}_{cohort}_{time_periods}`

* `format_stata_output`

* `format_R_output`


[View on OpenSAFELY](https://jobs.opensafely.org/repo/https%253A%252F%252Fgithub.com%252Fopensafely%252Fpost-covid-vaccinated)

Details of the purpose and any published outputs from this project can be found at the link above.

The contents of this repository MUST NOT be considered an accurate or valid representation of the study or its purpose. 
This repository may reflect an incomplete or incorrect analysis with no further ongoing work.
The content has ONLY been made public to support the OpenSAFELY [open science and transparency principles](https://www.opensafely.org/about/#contributing-to-best-practice-around-open-science) and to support the sharing of re-usable code for other subsequent users.
No clinical, policy or safety conclusions must be drawn from the contents of this repository.

# About the OpenSAFELY framework

The OpenSAFELY framework is a Trusted Research Environment (TRE) for electronic health records research in the NHS, with a focus on public accountability and research quality.

Read more at [OpenSAFELY.org](https://opensafely.org).

# Licences

As standard, research projects have a MIT license. 
