# Post-Covid-Events Preprocessing Scripts

## Points to note for all scripts below:
* **outputs**: See project yaml for an up to date list of outputs generated by these scripts. 
* If working with multiple cohorts and/or outcome groups, the scripts below will be structured as a large function so that the function can then run multiple times for each cohort/group using specified command arguments at the bottom or top of the script. 

## preprocess_data.R

* Reads in the raw input file (in feather format) which has been generated by the parameters defined in the study definition and common variables files. 
* Performs simple preprocessing and data checks to ensure data are in the correct format (numeric, character, date variables etc.).
* Adds any additional variables that could not be created in the study definition or common variables file.
* Defines outcome variables that require an algorithm by calling algorithm script (algorithm script if applicable described below). 
* Describes the dataset using sink().

## Stage1_data_cleaning.R

* Reads in the input file generated by preprocess_data.R.
* Prepares variables: handling NAs and assigning factor levels. 
* Write and apply quality assurance rules and save out a summary of these. 
* Apply exclusion/inclusion criteria and generate CSV for a flow chart of numbers included/excluded.
* Generate histograms of numerical variables so that researchers can see these inside the Level 4 environment.
* Save final input dataset ready for analyses. 

## create_follow_up_end_dates.R 

* Creates a dataset for each outcome group that includes the index date and follow-up end date for each patient_id. 

## diabetes_algorithm.R 

* A function called by preprocess_data.R to assign diabetes cases.
